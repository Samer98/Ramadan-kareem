<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ramadan Kareem ðŸ’š</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --ramadan-green: #0d5c2e;
      --ramadan-gold: #c9a227;
      --ramadan-cream: #f8f4e8;
      --text-dark: #1a2e1a;
    }

    body {
      font-family: 'Outfit', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, rgba(232, 245, 233, 0.6) 0%, rgba(241, 248, 233, 0.65) 50%, rgba(255, 248, 225, 0.65) 100%),
        url('https://images.unsplash.com/photo-1597848212624-e19eb5a2f2d4?w=1920&q=80') center/cover no-repeat fixed;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      overflow-x: hidden;
      position: relative;
    }

    /* Sunflowers in background */
    .sunflowers-bg {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .sunflower {
      position: absolute;
      font-size: 3rem;
      opacity: 0.35;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      animation: swaySunflower 6s ease-in-out infinite;
    }

    .sunflower:nth-child(1) { left: 5%; top: 8%; animation-delay: 0s; font-size: 2.5rem; }
    .sunflower:nth-child(2) { left: 15%; top: 75%; animation-delay: -1s; font-size: 3.5rem; }
    .sunflower:nth-child(3) { left: 35%; top: 5%; animation-delay: -2s; font-size: 2.8rem; }
    .sunflower:nth-child(4) { left: 55%; top: 85%; animation-delay: -0.5s; font-size: 3.2rem; }
    .sunflower:nth-child(5) { left: 75%; top: 12%; animation-delay: -3s; font-size: 2.6rem; }
    .sunflower:nth-child(6) { left: 90%; top: 55%; animation-delay: -1.5s; font-size: 3rem; }
    .sunflower:nth-child(7) { left: 8%; top: 45%; animation-delay: -2.5s; font-size: 2.4rem; }
    .sunflower:nth-child(8) { left: 45%; top: 40%; animation-delay: -0.8s; font-size: 2.2rem; }
    .sunflower:nth-child(9) { left: 85%; top: 88%; animation-delay: -1.2s; font-size: 2.9rem; }
    .sunflower:nth-child(10) { left: 22%; top: 28%; animation-delay: -2s; font-size: 2.7rem; }
    .sunflower:nth-child(11) { left: 65%; top: 65%; animation-delay: -3.5s; font-size: 3.1rem; }
    .sunflower:nth-child(12) { left: 42%; top: 92%; animation-delay: -0.3s; font-size: 2.3rem; }

    @keyframes swaySunflower {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }

    .butterflies {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .butterfly {
      position: absolute;
      font-size: 1.5rem;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.9;
      will-change: transform;
      filter: hue-rotate(200deg) saturate(1.3) drop-shadow(0 1px 2px rgba(0,0,0,0.15));
    }

    @keyframes flutterWings {
      0%, 100% { transform: scaleX(1); }
      50% { transform: scaleX(0.85); }
    }

    .butterfly-emoji {
      display: block;
      animation: flutterWings 0.2s ease-in-out infinite;
    }

    .container {
      text-align: center;
      max-width: 500px;
      position: relative;
      z-index: 2;
    }

    h1 {
      font-family: 'Amiri', serif;
      font-size: 2.2rem;
      color: var(--ramadan-green);
      margin-bottom: 2rem;
      line-height: 1.5;
      font-weight: 700;
    }

    .buttons-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      min-height: 120px;
      margin-top: 2rem;
    }

    .btn {
      padding: 1rem 2rem;
      font-size: 1.2rem;
      font-weight: 600;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-family: 'Outfit', sans-serif;
    }

    .btn-yes {
      background: linear-gradient(135deg, var(--ramadan-green), #1b7d3e);
      color: white;
      box-shadow: 0 4px 15px rgba(13, 92, 46, 0.4);
    }

    .btn-yes:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(13, 92, 46, 0.5);
    }

    .btn-no {
      position: relative;
      background: linear-gradient(135deg, #c62828, #b71c1c);
      color: white;
      box-shadow: 0 4px 15px rgba(198, 40, 40, 0.4);
      transition: none;
    }

    .btn-no:hover {
      transform: scale(1.02);
    }

    /* Modal styles */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      animation: fadeIn 0.3s ease;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: white;
      border-radius: 24px;
      padding: 2rem;
      max-width: 400px;
      width: 100%;
      text-align: center;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      animation: slideUp 0.4s ease;
    }

    .modal img {
      width: 100%;
      max-height: 280px;
      object-fit: cover;
      border-radius: 16px;
      margin-bottom: 1.5rem;
    }

    .modal h2 {
      font-family: 'Amiri', serif;
      color: var(--ramadan-green);
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .modal p {
      color: var(--text-dark);
      font-size: 1rem;
      line-height: 1.6;
    }

    .modal-signature {
      display: block;
      font-family: 'Amiri', serif;
      font-style: italic;
      color: var(--ramadan-green);
      font-size: 1rem;
      margin-top: 1rem;
      opacity: 0.9;
    }

    .modal-close {
      margin-top: 1.5rem;
      padding: 0.6rem 1.5rem;
      background: var(--ramadan-green);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-family: 'Outfit', sans-serif;
      font-weight: 500;
    }

    .modal-close:hover {
      background: #1b7d3e;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .crescent {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }

    /* Music controls */
    .music-controls {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 100;
    }

    .music-btn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, var(--ramadan-green), #1b7d3e);
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(13, 92, 46, 0.4);
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .music-btn:hover {
      transform: scale(1.08);
      box-shadow: 0 6px 20px rgba(13, 92, 46, 0.5);
    }

    .music-btn.playing {
      animation: pulseGlow 2s ease-in-out infinite;
    }

    .music-btn.song-btn {
      width: 44px;
      height: 44px;
      font-size: 1rem;
      font-weight: 600;
    }

    .music-btn.song-btn.active {
      background: linear-gradient(135deg, #1b7d3e, var(--ramadan-green));
      box-shadow: 0 4px 20px rgba(13, 92, 46, 0.6);
    }

    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 4px 15px rgba(13, 92, 46, 0.4); }
      50% { box-shadow: 0 4px 25px rgba(13, 92, 46, 0.6); }
    }
  </style>
</head>
<body>
  <div class="sunflowers-bg">
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
    <span class="sunflower">ðŸŒ»</span>
  </div>
  <div class="butterflies" id="butterflies"></div>

  <!-- Background music - Song 1 & 2 -->
  <audio id="bgMusic" preload="auto"></audio>
  <div class="music-controls">
    <button class="music-btn song-btn" id="song1" title="Song 1" aria-label="Song 1">1</button>
    <button class="music-btn song-btn" id="song2" title="Song 2" aria-label="Song 2">2</button>
    <button class="music-btn" id="musicToggle" title="Play/Pause" aria-label="Play/Pause">ðŸ”‡</button>
    <button class="music-btn" id="musicRestart" title="Restart song" aria-label="Restart song">ðŸ”„</button>
  </div>

  <div class="container">
    <div class="crescent">ðŸŒ™</div>
    <h1>Does Shorouk plan on saying Ramadan Kareem to me?</h1>

    <div class="buttons-wrapper">
      <button class="btn btn-yes" id="btnYes">Yes</button>
      <button class="btn btn-no" id="btnNo">No</button>
    </div>
  </div>

  <!-- Yes Modal -->
  <div class="modal-overlay" id="modalYes">
    <div class="modal">
      <img src="assets/yes-cat.png" alt="Happy cat">
      <h2>Ramadan Kareem! ðŸ’š</h2>
      <p>Thank you for wishing me it really made me smile! I hope I was able to make your day too.</p>
      <span class="modal-signature">â€” Samer</span>
      <button class="modal-close" onclick="closeModal('modalYes')">Close</button>
    </div>
  </div>

  <!-- No Modal (when user somehow clicks No) -->
  <div class="modal-overlay" id="modalNo">
    <div class="modal">
      <img src="assets/no-cat.png" alt="Cute cat">
      <h2>I am so happy to make you smile! ðŸ˜Š</h2>
      <p>I am so happy to make you smile and made your day.</p>
      <button class="modal-close" onclick="closeModal('modalNo')">Close</button>
    </div>
  </div>

  <script>
    // ========== CONFIG: Replace with your Formspree form ID for email notifications ==========
    // Get free form at https://formspree.io - they'll email you on each submission
    const FORMSPREE_ENDPOINT = 'https://formspree.io/f/xzdazalw';
    const TRACKING_ENABLED = true;

    function track(event, data = {}) {
      if (!TRACKING_ENABLED) return;
      const formData = new FormData();
      formData.append('event', event);
      formData.append('timestamp', new Date().toISOString());
      Object.keys(data).forEach(k => formData.append(k, data[k]));
      fetch(FORMSPREE_ENDPOINT, {
        method: 'POST',
        body: formData,
        headers: { 'Accept': 'application/json' }
      }).catch(() => {});
    }

    // IP-based geolocation - no permission needed (city, region, country, approx lat/lon)
    async function getIpLocation() {
      try {
        const r = await fetch('https://ipapi.co/json/');
        const j = await r.json();
        return {
          ip_city: j.city || '',
          ip_region: j.region || '',
          ip_country: j.country_name || '',
          ip_latitude: j.latitude || '',
          ip_longitude: j.longitude || ''
        };
      } catch {
        return {};
      }
    }

    function getLocationAndTrack(event, data = {}) {
      const doTrack = (extra = {}) => track(event, { ...data, ...extra });
      getIpLocation().then(ipLoc => doTrack(ipLoc));
    }

    // Track page visit on load (IP location only)
    document.addEventListener('DOMContentLoaded', () => {
      getLocationAndTrack('page_visit', { url: window.location.href });
    });

    // ========== Music: Song 1 & 2 selection, play/pause, restart ==========
    const SONGS = {
      1: 'assets/audio/Fireboy-DML-Ft-Ed-Sheeran-Peru-Remix-2.mp3',
      2: 'assets/audio/calm-down-official-music-video.mp3'
    };
    const bgMusic = document.getElementById('bgMusic');
    const musicToggle = document.getElementById('musicToggle');
    const musicRestart = document.getElementById('musicRestart');
    const song1Btn = document.getElementById('song1');
    const song2Btn = document.getElementById('song2');

    bgMusic.volume = 0.25;
    let currentSong = null;       // 1 or 2
    let songPositions = { 1: 0, 2: 0 }; // preserve position when switching songs

    function updateMusicUI() {
      const playing = !bgMusic.paused;
      musicToggle.textContent = playing ? 'ðŸ”Š' : 'ðŸ”‡';
      musicToggle.classList.toggle('playing', playing);
      song1Btn.classList.toggle('active', currentSong === 1);
      song2Btn.classList.toggle('active', currentSong === 2);
    }

    function loadAndPlaySong(num) {
      if (currentSong === num) {
        // Same song: toggle play/pause (continue, don't restart)
        if (bgMusic.paused) {
          bgMusic.currentTime = songPositions[num];
          bgMusic.play().then(() => updateMusicUI()).catch(() => {});
        } else {
          songPositions[num] = bgMusic.currentTime;
          bgMusic.pause();
          updateMusicUI();
        }
        return;
      }
      // Different song: switch
      if (currentSong) songPositions[currentSong] = bgMusic.currentTime;
      currentSong = num;
      bgMusic.src = SONGS[num];
      bgMusic.currentTime = songPositions[num];
      bgMusic.loop = false;
      bgMusic.play().then(() => updateMusicUI()).catch(() => {});
    }

    song1Btn.addEventListener('click', () => {
      getLocationAndTrack('music_click', { action: 'song1' });
      loadAndPlaySong(1);
    });
    song2Btn.addEventListener('click', () => {
      getLocationAndTrack('music_click', { action: 'song2' });
      loadAndPlaySong(2);
    });

    musicToggle.addEventListener('click', () => {
      getLocationAndTrack('music_click', { action: 'mute' });
      if (!currentSong) {
        loadAndPlaySong(1); // Default to song 1 if none selected
        return;
      }
      if (bgMusic.paused) {
        bgMusic.currentTime = songPositions[currentSong];
        bgMusic.play().then(() => updateMusicUI()).catch(() => {});
      } else {
        songPositions[currentSong] = bgMusic.currentTime;
        bgMusic.pause();
        updateMusicUI();
      }
    });

    musicRestart.addEventListener('click', () => {
      getLocationAndTrack('music_click', { action: 'reset' });
      if (!currentSong) return;
      songPositions[currentSong] = 0;
      bgMusic.currentTime = 0;
      if (bgMusic.paused) {
        bgMusic.play().then(() => updateMusicUI()).catch(() => {});
      }
      updateMusicUI();
    });

    bgMusic.addEventListener('timeupdate', () => {
      if (currentSong && !bgMusic.paused) songPositions[currentSong] = bgMusic.currentTime;
    });
    bgMusic.addEventListener('ended', () => {
      if (currentSong) songPositions[currentSong] = 0;
      updateMusicUI();
    });

    // ========== Butterflies: chase mouse cursor, then wander randomly from that point ==========
    const BUTTERFLY_COUNT = 35;
    const butterfliesContainer = document.getElementById('butterflies');
    const butterflies = [];
    const MOUSE_IDLE_MS = 1500;
    const CHASE_SPEED = 0.018;
    const RANDOM_SPEED = 0.007;
    const WANDER_RADIUS = 100;

    let mouseX = window.innerWidth / 2;
    let mouseY = window.innerHeight / 2;
    let lastMouseMove = 0;
    let chaseMode = false;

    function getRandomTargetNear(centerX, centerY, radius) {
      const angle = Math.random() * Math.PI * 2;
      const r = Math.random() * radius;
      return {
        x: Math.max(0, Math.min(window.innerWidth, centerX + Math.cos(angle) * r)),
        y: Math.max(0, Math.min(window.innerHeight, centerY + Math.sin(angle) * r))
      };
    }

    for (let i = 0; i < BUTTERFLY_COUNT; i++) {
      const el = document.createElement('div');
      el.className = 'butterfly';
      el.innerHTML = '<span class="butterfly-emoji">ðŸ¦‹</span>';
      const x = Math.random() * window.innerWidth;
      const y = Math.random() * window.innerHeight;
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      el.style.transform = 'translate(-50%, -50%)';
      butterfliesContainer.appendChild(el);
      butterflies.push({
        el,
        x, y,
        offsetX: (Math.random() - 0.5) * 120,
        offsetY: (Math.random() - 0.5) * 120,
        speed: CHASE_SPEED + Math.random() * 0.02,
        randomSpeed: RANDOM_SPEED + Math.random() * 0.005,
        target: getRandomTargetNear(x, y, WANDER_RADIUS),
        angle: Math.random() * 360
      });
    }

    function setMouseAndChase(x, y) {
      mouseX = x;
      mouseY = y;
      lastMouseMove = Date.now();
      chaseMode = true;
    }

    document.addEventListener('mousemove', (e) => setMouseAndChase(e.clientX, e.clientY));
    document.addEventListener('touchmove', (e) => {
      if (e.touches.length) setMouseAndChase(e.touches[0].clientX, e.touches[0].clientY);
    }, { passive: true });
    document.addEventListener('touchstart', (e) => {
      if (e.touches.length) setMouseAndChase(e.touches[0].clientX, e.touches[0].clientY);
    }, { passive: true });

    function animateButterflies() {
      const now = Date.now();
      if (now - lastMouseMove > MOUSE_IDLE_MS) {
        if (chaseMode) {
          butterflies.forEach((b) => {
            b.target = getRandomTargetNear(b.x, b.y, WANDER_RADIUS);
          });
        }
        chaseMode = false;
      }

      butterflies.forEach((b) => {
        let targetX, targetY;
        let speed = b.speed;

        if (chaseMode) {
          targetX = mouseX + b.offsetX;
          targetY = mouseY + b.offsetY;
          speed = b.speed;
        } else {
          targetX = b.target.x;
          targetY = b.target.y;
          speed = b.randomSpeed;
          const dx = targetX - b.x;
          const dy = targetY - b.y;
          const dist = Math.hypot(dx, dy);
          if (dist < 15) {
            b.target = getRandomTargetNear(b.x, b.y, WANDER_RADIUS);
          }
        }

        b.x += (targetX - b.x) * speed;
        b.y += (targetY - b.y) * speed;
        const dx = targetX - b.x;
        const dy = targetY - b.y;
        const angle = Math.atan2(dy, dx) * (180 / Math.PI);
        b.el.style.left = b.x + 'px';
        b.el.style.top = b.y + 'px';
        b.el.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
      });
      requestAnimationFrame(animateButterflies);
    }

    requestAnimationFrame(animateButterflies);

    const btnYes = document.getElementById('btnYes');
    const btnNo = document.getElementById('btnNo');
    const wrapper = document.querySelector('.buttons-wrapper');

    // Yes button - show popup with thank you message
    btnYes.addEventListener('click', () => {
      getLocationAndTrack('button_click', { button: 'yes' });
      document.getElementById('modalYes').classList.add('active');
    });

    // No button - teleport anywhere on screen, super impossible to click
    let escaped = false;

    function getRandomViewportPosition() {
      const btnRect = btnNo.getBoundingClientRect();
      const margin = 20;
      const maxX = window.innerWidth - btnRect.width - margin * 2;
      const maxY = window.innerHeight - btnRect.height - margin * 2;
      return {
        left: Math.random() * maxX + margin,
        top: Math.random() * maxY + margin
      };
    }

    function teleportNoButton() {
      escaped = true;
      btnNo.style.position = 'fixed';
      btnNo.style.zIndex = '999';
      btnNo.style.left = '';
      btnNo.style.top = '';
      const pos = getRandomViewportPosition();
      btnNo.style.left = pos.left + 'px';
      btnNo.style.top = pos.top + 'px';
      // Send to Formspree when the moving button changes place
      getLocationAndTrack('moving_button', {
        new_left: pos.left,
        new_top: pos.top
      });
    }

    // Teleport when mouse enters the button
    btnNo.addEventListener('mouseenter', teleportNoButton);

    // Teleport when cursor approaches - large danger zone, anywhere on document
    const DANGER_ZONE = 150;
    let lastTeleport = 0;
    document.addEventListener('mousemove', (e) => {
      if (Date.now() - lastTeleport < 50) return;
      const btnRect = btnNo.getBoundingClientRect();
      const cx = btnRect.left + btnRect.width / 2;
      const cy = btnRect.top + btnRect.height / 2;
      const dist = Math.hypot(e.clientX - cx, e.clientY - cy);
      if (dist < DANGER_ZONE) {
        lastTeleport = Date.now();
        teleportNoButton();
      }
    });

    // Teleport on touch - move before touch can register
    btnNo.addEventListener('touchstart', (e) => {
      e.preventDefault();
      teleportNoButton();
    }, { passive: false });

    // Also teleport when touch moves near the button (for mobile)
    document.addEventListener('touchmove', (e) => {
      if (!escaped || !e.touches.length) return;
      const t = e.touches[0];
      const btnRect = btnNo.getBoundingClientRect();
      const cx = btnRect.left + btnRect.width / 2;
      const cy = btnRect.top + btnRect.height / 2;
      const dist = Math.hypot(t.clientX - cx, t.clientY - cy);
      if (dist < DANGER_ZONE) teleportNoButton();
    }, { passive: true });

    // If user somehow clicks No - show the "happy to make you smile" modal
    btnNo.addEventListener('click', (e) => {
      e.preventDefault();
      getLocationAndTrack('button_click', { button: 'no' });
      document.getElementById('modalNo').classList.add('active');
    });

    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    // Close modal when clicking overlay
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) overlay.classList.remove('active');
      });
    });

  </script>
</body>
</html>
